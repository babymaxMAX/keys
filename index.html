<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>LsJ VPN ‚Äî –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#111111">
  <style>
    :root{
      --bg-1:#0b0b0f;
      --bg-2:#101218;
      --brand:#f7c23e;          /* –∑–æ–ª–æ—Ç–æ LsJ */
      --brand-2:#ff9900;        /* –∞–∫—Ü–µ–Ω—Ç */
      --text:#e9edf3;
      --muted:#a7adba;
      --card:#141825;
      --card-2:#0f1420;
      --glow:rgba(247,194,62,0.25);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 800px at 70% -10%, #1c2135 0%, transparent 70%),
                                      radial-gradient(900px 700px at 0% 100%, #1b1626 0%, transparent 65%),
                                      linear-gradient(180deg, var(--bg-1), var(--bg-2));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", "Segoe UI Emoji";
      display:grid; place-items:center;
    }
    .wrap{
      width:min(720px, 92vw);
      padding:28px 24px 32px;
      border-radius:18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)) padding-box,
        radial-gradient(120% 180% at 0% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0.01)) border-box;
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:
        0 10px 35px rgba(0,0,0,0.45),
        0 0 0 2px rgba(255,255,255,0.02) inset,
        0 0 80px 0 var(--glow);
      backdrop-filter: blur(6px);
    }
    .brand{
      display:flex; align-items:center; gap:16px; margin-bottom:8px;
    }
    .logo{
      width:64px; height:64px; border-radius:50%;
      display:grid; place-items:center;
      background: radial-gradient(circle at 50% 40%, var(--brand) 0%, var(--brand-2) 60%, #a96700 100%);
      box-shadow: 0 0 30px var(--glow), 0 8px 24px rgba(0,0,0,0.45);
      transform: translateZ(0);
    }
    .logo svg{ filter: drop-shadow(0 2px 8px rgba(0,0,0,0.35)); }
    .title{
      line-height:1.1;
      font-weight:800;
      letter-spacing:0.2px;
      font-size:28px;
    }
    .subtitle{
      color:var(--muted);
      margin:0 0 22px 80px;
      letter-spacing:0.2px;
    }
    .btn{
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      appearance:none; border:none; cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center; gap:12px;
      font-weight:700; font-size:18px; letter-spacing:0.2px;
      border-radius:14px; padding:18px 22px; min-height:58px; width:100%;
      transition: transform .08s ease, box-shadow .15s ease, filter .15s ease;
      text-decoration:none; color:#151515;
    }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn-primary{
      background: linear-gradient(180deg, var(--brand) 0%, var(--brand-2) 85%);
      box-shadow:
        0 15px 40px rgba(247,194,62,0.25),
        0 2px 0 0 rgba(255,255,255,0.2) inset;
    }
    .btn-primary:hover{ filter: brightness(1.02); box-shadow: 0 18px 50px rgba(247,194,62,0.3), 0 2px 0 rgba(255,255,255,0.25) inset; }
    .btn-ghost{
      color:var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.12);
      box-shadow: 0 8px 24px rgba(0,0,0,0.35);
    }
    .btn-ghost:hover{ border-color: rgba(255,255,255,0.18); background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); }
    .grid{ display:grid; gap:14px; grid-template-columns:1fr; }
    .note{ color:var(--muted); margin:18px 0 0; text-align:center; font-size:13px; }
    .toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(30px);
      background:#0f1220; color:var(--text); border:1px solid rgba(255,255,255,0.12);
      padding:10px 14px; border-radius:10px; opacity:0; transition:.22s ease; pointer-events:none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.55);
      font-size:14px;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }
    .hid{ display:none; }
  </style>
</head>
<body>
  <main class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg width="34" height="34" viewBox="0 0 24 24" fill="#111"><path d="M12 2l.894 2.763h2.905l-2.351 1.708.897 2.762L12 7.525 9.655 9.233l.897-2.762L8.2 4.763h2.905L12 2z"/></svg>
      </div>
      <div>
        <div class="title">LsJ VPN</div>
        <div class="subtitle">Comrades ‚Ä¢ Premium Access</div>
      </div>
    </div>

    <div class="grid" style="margin-top:14px">
      <a id="btnConnect" class="btn btn-primary" href="#">üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPN</a>
      <button id="btnCopy" class="btn btn-ghost" type="button">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
    </div>

    <p id="hint" class="note hid">–û—Ç–∫—Ä–æ–π –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ, –µ—Å–ª–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥.</p>
  </main>

  <div id="toast" class="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</div>

  <script>
    const ua = navigator.userAgent || "";
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
    const isInApp = /WhatsApp|FBAN|FBAV|Instagram|Line|VKClient|Telegram/i.test(ua);

    const qs = new URLSearchParams(location.search);
    const id = parseInt(qs.get('id'), 10);

    const btnConnect = document.getElementById('btnConnect');
    const btnCopy = document.getElementById('btnCopy');
    const toast = document.getElementById('toast');
    const hint = document.getElementById('hint');

    const statusText = document.querySelector('.subtitle');

    if (!Number.isFinite(id) || id < 1) {
      statusText.textContent = '–ù—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä ?id=1..300';
    } else {
      init().catch(err=>{
        statusText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–∞';
        console.error(err);
      });
    }

    async function ensureSW(){
      if(!('serviceWorker' in navigator)) return;
      try{
        await navigator.serviceWorker.register('/sw.js',{scope:'/'});
        if(!navigator.serviceWorker.controller) await new Promise(r=>setTimeout(r,150));
      }catch(_){}
    }

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), 1300);
    }

    function toDeepLinkFromVless(vless){
      return 'v2raytun://import/' + encodeURIComponent(vless);
    }

    async function init(){
      await ensureSW();

      const subUrl = '/sub?id=' + id;
      const r = await fetch(subUrl, { cache: 'no-store' });
      if(!r.ok) throw new Error('sub?id='+id+' not ok');
      const vless = (await r.text()).trim();
      if(!/^vless:\/\//i.test(vless)) throw new Error('not vless');

      const deep = toDeepLinkFromVless(vless);

      // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPN"
      btnConnect.setAttribute('href', deep);
      btnConnect.addEventListener('click', (e)=>{ /* –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ */ });

      // –ö–Ω–æ–ø–∫–∞ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á"
      btnCopy.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(vless);
          showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
        }catch{
          // –§–æ–ª–±—ç–∫ —á–µ—Ä–µ–∑ textarea
          const ta = document.createElement('textarea');
          ta.value = vless;
          document.body.appendChild(ta);
          ta.select(); document.execCommand('copy');
          ta.remove();
          showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
        }
      });

      // Hint –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
      if(isInApp) hint.classList.remove('hid');

      // (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ, –µ—Å–ª–∏ –Ω–µ –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
      if(isMobile && !isInApp){
        try{ location.href = deep; }catch(_){}
      }
    }
  </script>
</body>
</html>
